香港适宜建设土地选址
一、数据集（示例）
POI	诊所、医院、邮局、市场、学校、废物处理厂、污水处理厂
交通	公交路线、公交站、地铁出入口、地铁线路、道路
人口密度	只有2021，HK五年一次人口普查，下次是2026
约束条件	HK坡度栅格、地形大于54度陡峭地带、27类土地利用、特别规划区域、郊野公园
地区数据	HK海岸线矢量

二、技术路线（示例）
1、划分出可建设土地
（1）HK海岸线矢量+（地形大于54度陡峭地带+土地利用（取已利用类别）+特别规划区域+郊野公园）->交集取反=可选建设土地
2、POI距离计算
（1）每类POI都进行计算“欧氏距离”=各类距离栅格（一定要作为tif输出到文件，不然重分类闪退）
（2）各类距离栅格->重分类（1-10）=得分栅格，分类取“相等间隔”并分为10类（积极设施距离越近得分越高，厌恶型设施距离越近得分越低（“对新值取反”），得分按照距离等间隔划分成10份，即1-10分）
（3）设定范围外的值：即将NoData值转为0（厌恶型设施则为10），栅格计算器，表达式：Con(IsNull(“输入栅格”), 值, “输入栅格”)
3、各地区评分
（1）整体评分栅格：栅格计算器，表达式：（“图层1” * 权重小数1）+（“图层2” * 权重小数2）+…，计算得到整个HK区域的评分栅格
（2）整个区域评分栅格，转矢量（勾选“简化面“），得到整个区域评分矢量
（3）整个区域评分矢量+可选建设土地->相交=适合选址地区及评分，评分即为其属性表中的对应的栅格的值
 

三、Add-on插件需求
1、总体需求：
（1）	输入地区，输入约束条件数据，输入POI数据，进行上述技术路线处理后，输出“评分矢量数据”，在符号系统中，选取“多级色彩”，并以评分字段为分类标准 
（2）	**输出“评分矢量数据”属性表包含：评分、每个POI的距离、坡度、权重、面积、行政区划人口密度**（此点需求先忽略，先输出仅具有评分的矢量数据）
2、功能需求：
（1）	根据输入的多个约束条件数据以及地区，施行技术路线中“1、划分出可建设土地“操作，即地区数据与所有的输入的约束条件数据进行交集取反操作，所得结果为可建设土地的矢量数据，存入临时文件（”Suitable_Area.shp”）中
（2）	技术路线中的“2、POI距离计算”中：
A.	计算欧氏距离功能：根据“POI”分块中的多行“输入数据”，其中有栅格或矢量数据，如果是栅格数据，则无需进行“欧氏距离”计算；如果为矢量数据，根据对应行中输入的“距离”，既有正数也有负数，取其绝对值，通过工具计算“欧氏距离”，计算结果为栅格数据保存到临时文件(f“{输入数据名}_distance.tif”)；
B.	完成距离计算后进行“重分类”功能：
a)	重分类操作的输入栅格：遍历每一行“输入数据”，如果为矢量则为对应的“欧氏距离”的计算结果栅格作为输入栅格，如果为栅格数据，则直接作为输入栅格，重分类字段为该栅格的“VALUE”。
b)	对其进行分类时，分类方法默认为“相等间隔”，分为“10”类，分别为整数1到10，取每一个“输入数据”的“距离”栏，如果为正数，则采取“对新值取反”操作，即分类反向：类别中距离越小，分类值越大；如果为负数，则不采取“对新值取反”操作，即类别中距离越小，分类值越小。
c)	对于每一个“输入数据”的“自定义距离间隔”栏，如果为“否”，则以上述“相等间隔”分类方法进行分类；如果为“是”，则弹出新窗口要求输入自定义分类间隔，窗口包括该数据的名称，分类表格，确定按钮，分类表格列名为开始、结束、类别，分别代表该类别的开始值、该类别的结束值、类别值，分类表格的行则表示每一类别，共10行，代表0-10或10-0类别，弹出窗口时分类表格的默认值为以“相等间隔”进行划分过后的值，弹出窗口的分类表格示例如下图：
路径下的“图1分类表格.png”
d)	重分类后的结果栅格保存到临时文件（f“{输入数据名}_reclassification.tif”）中
C.	设定范围外的值功能：重分类结束后，需要设定范围外的值：遍历“POI“分块中的每行，取”输入数据“的对应重分类后的结果栅格，同时根据”距离“栏的正负值，如果为正，则将结果栅格中的NoData值改为0；如果为负，则将结果栅格中的NoData值改为10。所得结果栅格存入临时文件（f“{输入数据名}_reclassification_ND.tif”）中
（3）	技术路线中“3、各地区评分计算”：
A.	计算整个地区的评分栅格功能：遍历“POI”分块中的每行，取“输入数据”的对应更改范围外的值后的结果栅格，以及对应的“权重”，通过栅格计算器，计算表达式伪代码：“（结果栅格1*权重1）+（结果栅格2*权重2）+（结果栅格3*权重3）+…”，计算得到整个地区的评分栅格，结果栅格存入临时文件（f“{地区的分析区域文件名}_rating.tif”）中
B.	整个地区评分栅格转矢量功能：将整个地区的评分栅格数据转为矢量数据，结果矢量存入临时文件（f“{地区的分析区域文件名}_rating.shp”）中
C.	相交操作取适合选址地区及评分功能：将整个地区的评分矢量数据与（1）中的可建设土地矢量数据（“Suitable_Area.shp”）取相交部分，即取交集，得到最终的适合选址地区及评分矢量数据，存入结果文件（“Result_Rating_Suitable_Area.shp”）中 
（4）	其他描述：得到最终结果后，删除所有临时文件，并将结果加载到ArcGIS Pro的地图图层中，在符号系统设定如“1、总体需求”（1）所述。

3、模块化需求：
（1）	功能需求中的三点（“1、划分出可建设土地”、“2、POI距离计算”、“3、各地区评分计算”）对应三个功能大模块，分为三大文件夹，文件夹名：“Divide”、“Distance”、“Rating”
（2）	 每个功能大模块文件夹中包含对应功能模块的文件，按照功能需求中的二级分点进行划分，模块与分点一一对应
4、界面需求：
（1）	界面设计如下图
路径下的“图2界面设计.png”
（2）	约束条件中，要求能够批量输入数据，根据输入显示数据名称，右侧文件图标可以打开文件路径窗口对其进行修改，同时应支持从图层中拖动进行输入，每输入一个数据则新增一行空白提供下一次输入，空白行不参与选址分析
（3）	地区中，能够点击右边小图标打开文件路径选择输入要素，仅可输入一个地区数据
（4）	POI中，以表格形式输入，列包括“输入数据”、“距离”、“权重”、“自定义距离间隔”，每行为依次输入的POI要素矢量或栅格（比如坡度栅格）；输入数据列中，每个输入数据中提供文件小图标用于打开路径窗口，每新增一个数据，则新增一行空白提供下一次输入，空白列仅提供输入不参与分析；距离列中，以米为单位，类型为整型，可输入正数或负数或留空，当输入为栅格数据时，该行中的距离栏强制为空，不允许输入；权重列中，类型为浮点，输入小于1.0的数，仅保留两位小数，同时检查所有输入的要素或栅格的权重之和是否为1.0，并以红色文字提醒；自定义距离间隔中，除空白行外，每行提供下拉框用于选择“是“或”否“，默认为”否“。
（5）	输出中，能够点击右边小图标打开文件路径选择输出路径以及文件名，仅可输出到一个路径以及一个文件名
（6）	右下角为运行按钮，点击后可运行选址分析

