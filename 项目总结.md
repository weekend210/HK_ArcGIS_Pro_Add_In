# HK_AREA_SEARCH 项目总结

HK_AREA_SEARCH 是一个用于香港适宜建设土地选址分析的高级ArcGIS Pro插件。该项目实现了基于多个约束条件和兴趣点(POI)分析来确定适宜建设土地的综合工作流程。

## 项目概述
- **类型**: ArcGIS Pro插件
- **语言**: C#
- **框架**: .NET 6.0, WPF, ArcGIS Pro SDK
- **架构**: MVVM (Model-View-ViewModel)

## 核心功能
系统执行三个主要分析阶段:
1. **Divide模块**: 通过从分析区域减去约束区域来确定可建设土地
2. **Distance模块**: 计算POI距离并处理栅格数据
3. **Rating模块**: 将所有因素结合为最终适宜性评级

## 主要组件

### UI层
- `main_dockpane.xaml`: 主用户界面，具有动态行管理功能
- `main_dockpaneViewModel.cs`: 处理用户交互并协调分析
- 约束和POI输入的动态空行管理

### 业务逻辑层
- **Divide模块**: 实现土地分割逻辑和几何运算
- **Distance模块**: 执行距离计算和栅格处理
- **Rating模块**: 执行加权评级计算

### 基础设施层
- 临时文件管理、图层管理和符号系统服务
- 数据验证、拖放操作和路径处理辅助工具

## 执行流程

### 1. 入口点: `Module1.cs`
- ArcGIS Pro模块初始化
- 查找并注册主dockpane

### 2. UI交互: `main_dockpaneViewModel.cs`
- 用户点击"▶ 运行"按钮
- 触发`RunAnalysisCommand`命令
- 使用`ValidationHelper`验证所有输入

### 3. 分析协调在`RunAnalysisAsync`中
```
RunAnalysisAsync()
├── 数据验证
│   ├── 输入路径存在性
│   ├── 权重总和 = 1.0
│   └── 文件格式支持
├── 临时文件管理器初始化
├── Divide模块执行
│   ├── 输入: 分析区域 + 约束
│   ├── 算法: 差集运算 (分析区域 - 约束)
│   └── 输出: Suitable_Area.shp
├── Distance模块执行
│   ├── 对每个POI:
│   │   ├── 识别数据类型 (矢量/栅格)
│   │   ├── 计算欧氏距离 (对矢量)
│   │   ├── 重新分类栅格
│   │   └── 处理NoData值
│   └── 输出: 处理后的栅格字典
├── Rating模块执行
│   ├── 加权求和计算
│   ├── 栅格转矢量
│   ├── 与适宜区域相交
│   └── 输出: 最终结果要素类
├── 清理临时文件
├── 将结果添加到地图
└── 应用符号系统
```

### 4. Divide模块 (`DivideService`)
- 使用并集运算合并所有约束图层
- 使用差集运算从分析区域中减去合并的约束
- 输出适宜土地要素类

### 5. Distance模块 (`DistanceService`)
- 对每个POI项:
  - 确定数据是矢量(要素类)还是栅格(影像)
  - 如果是矢量: 计算到要素的欧氏距离
  - 如果是栅格: 使用原始值
  - 根据等间隔或自定义类别进行重新分类
  - 根据距离符号处理NoData值

### 6. Rating模块 (`RatingService`)
- 使用处理后的栅格和权重执行加权求和计算
- 将结果栅格转换为矢量
- 与适宜区域相交产生最终结果
- 返回最终要素类路径

### 7. 后处理
- 临时文件清理
- 结果图层添加到当前地图
- 应用符号系统以可视化评级结果
- 显示成功/错误消息

## 主要特性
- **动态UI**: 约束和POI输入的自动空行管理
- **拖放功能**: 易于数据导入功能
- **混合数据类型**: 支持矢量和栅格输入
- **距离计算**: 矢量POI的欧氏距离
- **加权评级**: 不同因素的灵活权重系统
- **临时文件管理**: 中间文件的自动清理
- **地图集成**: 在ArcGIS Pro中的直接结果可视化

该项目为使用多个标准进行适宜建设区域的空间分析提供了完整的解决方案，具有良好的架构，将UI、业务逻辑和基础设施关注点分离。