# é¦™æ¸¯é€‚å®œå»ºè®¾åœŸåœ°é€‰å€å·¥å…· - ç•Œé¢ä»£ç è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€æ•´ä½“æ¶æ„

æœ¬æ–¹æ¡ˆé‡‡ç”¨ **MVVM (Model-View-ViewModel)** æ¶æ„æ¨¡å¼ï¼ŒåŸºäº ArcGIS Pro SDK for .NET è¿›è¡Œå¼€å‘ã€‚

### 1.1 æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
HK_AREA_SEARCH/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ main_dockpane.xaml                     // ä¸»ç•Œé¢XAML
â”‚   â””â”€â”€ CustomIntervalDialog.xaml              // è‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ main_dockpaneViewModel.cs              // ä¸»ç•Œé¢ViewModel
â”‚   â””â”€â”€ CustomIntervalDialogViewModel.cs       // å¯¹è¯æ¡†ViewModel
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ ConstraintDataItem.cs                  // çº¦æŸæ¡ä»¶æ•°æ®é¡¹æ¨¡å‹
â”‚   â”œâ”€â”€ POIDataItem.cs                         // POIæ•°æ®é¡¹æ¨¡å‹
â”‚   â””â”€â”€ IntervalClassItem.cs                   // åˆ†ç±»é—´éš”é¡¹æ¨¡å‹
â”œâ”€â”€ Controls/
â”‚   â”œâ”€â”€ FilePathTextBox.xaml                   // æ–‡ä»¶è·¯å¾„è¾“å…¥æ§ä»¶
â”‚   â””â”€â”€ DataGridRowWithValidation.cs           // å¸¦éªŒè¯çš„æ•°æ®ç½‘æ ¼è¡Œ
â”œâ”€â”€ Converters/
â”‚   â”œâ”€â”€ BooleanToYesNoConverter.cs             // å¸ƒå°”å€¼è½¬"æ˜¯/å¦"è½¬æ¢å™¨
â”‚   â””â”€â”€ WeightSumValidationConverter.cs        // æƒé‡å’ŒéªŒè¯è½¬æ¢å™¨
â””â”€â”€ Helpers/
    â””â”€â”€ DragDropHelper.cs                      // æ‹–æ”¾è¾…åŠ©ç±»
```

---

## äºŒã€æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 çº¦æŸæ¡ä»¶æ•°æ®é¡¹ (ConstraintDataItem.cs)

```csharp
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace HK_AREA_SEARCH.Models
{
    /// <summary>
    /// çº¦æŸæ¡ä»¶æ•°æ®é¡¹æ¨¡å‹
    /// </summary>
    public class ConstraintDataItem : INotifyPropertyChanged
    {
        private string _dataPath;
        private string _dataName;

        /// <summary>
        /// æ•°æ®æ–‡ä»¶è·¯å¾„
        /// </summary>
        public string DataPath
        {
            get => _dataPath;
            set
            {
                if (_dataPath != value)
                {
                    _dataPath = value;
                    OnPropertyChanged();
                    // è‡ªåŠ¨æå–æ–‡ä»¶å
                    DataName = System.IO.Path.GetFileNameWithoutExtension(value);
                }
            }
        }

        /// <summary>
        /// æ•°æ®åç§°ï¼ˆæ˜¾ç¤ºç”¨ï¼‰
        /// </summary>
        public string DataName
        {
            get => _dataName;
            set
            {
                if (_dataName != value)
                {
                    _dataName = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// æ˜¯å¦ä¸ºç©ºç™½è¡Œ
        /// </summary>
        public bool IsEmpty => string.IsNullOrWhiteSpace(DataPath);

        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}
```

### 2.2 POIæ•°æ®é¡¹ (POIDataItem.cs)

```csharp
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace HK_AREA_SEARCH.Models
{
    /// <summary>
    /// POIæ•°æ®é¡¹æ¨¡å‹
    /// </summary>
    public class POIDataItem : INotifyPropertyChanged
    {
        private string _dataPath;
        private string _dataName;
        private int? _distance;
        private double? _weight;
        private bool _customInterval;
        private bool _isRasterData;

        /// <summary>
        /// è¾“å…¥æ•°æ®è·¯å¾„
        /// </summary>
        public string DataPath
        {
            get => _dataPath;
            set
            {
                if (_dataPath != value)
                {
                    _dataPath = value;
                    OnPropertyChanged();
                    DataName = System.IO.Path.GetFileNameWithoutExtension(value);

                    // åˆ¤æ–­æ˜¯å¦ä¸ºæ …æ ¼æ•°æ®
                    var ext = System.IO.Path.GetExtension(value)?.ToLower();
                    IsRasterData = ext == ".tif" || ext == ".tiff" || ext == ".img";
                }
            }
        }

        /// <summary>
        /// æ•°æ®åç§°
        /// </summary>
        public string DataName
        {
            get => _dataName;
            set
            {
                if (_dataName != value)
                {
                    _dataName = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// è·ç¦»ï¼ˆç±³ï¼‰ï¼Œæ­£æ•°æˆ–è´Ÿæ•°
        /// </summary>
        public int? Distance
        {
            get => _distance;
            set
            {
                // å¦‚æœæ˜¯æ …æ ¼æ•°æ®ï¼Œå¼ºåˆ¶ä¸ºç©º
                if (IsRasterData)
                {
                    _distance = null;
                }
                else
                {
                    _distance = value;
                }
                OnPropertyChanged();
            }
        }

        /// <summary>
        /// æƒé‡ï¼ˆå°äº1.0çš„æµ®ç‚¹æ•°ï¼Œä¿ç•™ä¸¤ä½å°æ•°ï¼‰
        /// </summary>
        public double? Weight
        {
            get => _weight;
            set
            {
                if (value.HasValue)
                {
                    _weight = Math.Round(value.Value, 2);
                }
                else
                {
                    _weight = value;
                }
                OnPropertyChanged();
            }
        }

        /// <summary>
        /// æ˜¯å¦è‡ªå®šä¹‰è·ç¦»é—´éš”
        /// </summary>
        public bool CustomInterval
        {
            get => _customInterval;
            set
            {
                if (_customInterval != value)
                {
                    _customInterval = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// æ˜¯å¦ä¸ºæ …æ ¼æ•°æ®
        /// </summary>
        public bool IsRasterData
        {
            get => _isRasterData;
            private set
            {
                if (_isRasterData != value)
                {
                    _isRasterData = value;
                    OnPropertyChanged();
                    OnPropertyChanged(nameof(IsDistanceEnabled));

                    // å¦‚æœæ˜¯æ …æ ¼æ•°æ®ï¼Œæ¸…ç©ºè·ç¦»
                    if (_isRasterData)
                    {
                        Distance = null;
                    }
                }
            }
        }

        /// <summary>
        /// è·ç¦»å­—æ®µæ˜¯å¦å¯ç¼–è¾‘
        /// </summary>
        public bool IsDistanceEnabled => !IsRasterData;

        /// <summary>
        /// æ˜¯å¦ä¸ºç©ºç™½è¡Œ
        /// </summary>
        public bool IsEmpty => string.IsNullOrWhiteSpace(DataPath);

        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}
```

### 2.3 åˆ†ç±»é—´éš”é¡¹ (IntervalClassItem.cs)

```csharp
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace HK_AREA_SEARCH.Models
{
    /// <summary>
    /// åˆ†ç±»é—´éš”é¡¹æ¨¡å‹ï¼ˆç”¨äºè‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†ï¼‰
    /// </summary>
    public class IntervalClassItem : INotifyPropertyChanged
    {
        private double _startValue;
        private double _endValue;
        private int _classValue;

        /// <summary>
        /// å¼€å§‹å€¼
        /// </summary>
        public double StartValue
        {
            get => _startValue;
            set
            {
                if (_startValue != value)
                {
                    _startValue = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// ç»“æŸå€¼
        /// </summary>
        public double EndValue
        {
            get => _endValue;
            set
            {
                if (_endValue != value)
                {
                    _endValue = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// ç±»åˆ«å€¼ï¼ˆ0-10æˆ–10-0ï¼‰
        /// </summary>
        public int ClassValue
        {
            get => _classValue;
            set
            {
                if (_classValue != value)
                {
                    _classValue = value;
                    OnPropertyChanged();
                }
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}
```

---

## ä¸‰ã€ä¸»ç•Œé¢XAMLè®¾è®¡ (main_dockpane.xaml)

```xaml
<UserControl x:Class="HK_AREA_SEARCH.main_dockpaneView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="clr-namespace:HK_AREA_SEARCH"
             xmlns:extensions="clr-namespace:ArcGIS.Desktop.Extensions;assembly=ArcGIS.Desktop.Extensions"
             xmlns:converters="clr-namespace:HK_AREA_SEARCH.Converters"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="850"
             d:DataContext="{Binding Path=ui.main_dockpaneViewModel}"
             AllowDrop="True">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <extensions:DesignOnlyResourceDictionary Source="pack://application:,,,/ArcGIS.Desktop.Framework;component\Themes\Default.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- è½¬æ¢å™¨ -->
            <converters:BooleanToYesNoConverter x:Key="BoolToYesNoConverter"/>

            <!-- æ ·å¼å®šä¹‰ -->
            <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Margin" Value="0,10,0,5"/>
            </Style>

            <Style x:Key="FolderButtonStyle" TargetType="Button">
                <Setter Property="Width" Value="30"/>
                <Setter Property="Height" Value="25"/>
                <Setter Property="Margin" Value="5,0,0,0"/>
                <Setter Property="Content" Value="ğŸ“"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜ -->
        <TextBlock Grid.Row="0"
                   Text="é¦™æ¸¯é€‰å€å·¥å…·"
                   Style="{DynamicResource Esri_TextBlockDockPaneHeader}"
                   FontSize="18"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,10"/>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- 1. çº¦æŸæ¡ä»¶éƒ¨åˆ† -->
                <TextBlock Text="çº¦æŸæ¡ä»¶" Style="{StaticResource SectionHeaderStyle}"/>
                <Border BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="0,5,0,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- æ ‡é¢˜è¡Œ -->
                        <Grid Grid.Row="0" Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="40"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="è¾“å…¥è¦ç´ " FontWeight="Bold" VerticalAlignment="Center"/>
                        </Grid>

                        <!-- çº¦æŸæ¡ä»¶åˆ—è¡¨ -->
                        <ItemsControl Grid.Row="1" ItemsSource="{Binding ConstraintItems}" MaxHeight="200">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="40"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- ä¸‹æ‹‰å›¾æ ‡ï¼ˆè£…é¥°ç”¨ï¼‰ -->
                                        <TextBlock Grid.Column="0" Text="â–¼" VerticalAlignment="Center" Margin="5,0"/>

                                        <!-- æ•°æ®åç§°æ˜¾ç¤º -->
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding DataName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 IsReadOnly="True"
                                                 Background="White"
                                                 VerticalContentAlignment="Center"
                                                 AllowDrop="True"
                                                 PreviewDragOver="ConstraintItem_PreviewDragOver"
                                                 Drop="ConstraintItem_Drop"
                                                 Margin="2,0"/>

                                        <!-- æ–‡ä»¶å¤¹æŒ‰é’® -->
                                        <Button Grid.Column="2"
                                                Style="{StaticResource FolderButtonStyle}"
                                                Command="{Binding DataContext.BrowseConstraintCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </Border>

                <!-- 2. åœ°åŒºéƒ¨åˆ† -->
                <TextBlock Text="åœ°åŒº" Style="{StaticResource SectionHeaderStyle}"/>
                <Border BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="0,5,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="åˆ†æåŒºåŸŸ" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding AnalysisAreaPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 VerticalContentAlignment="Center"
                                 Margin="5,0"
                                 AllowDrop="True"
                                 PreviewDragOver="AnalysisArea_PreviewDragOver"
                                 Drop="AnalysisArea_Drop"/>
                        <Button Grid.Column="2"
                                Style="{StaticResource FolderButtonStyle}"
                                Command="{Binding BrowseAnalysisAreaCommand}"/>
                    </Grid>
                </Border>

                <!-- 3. POIéƒ¨åˆ† -->
                <TextBlock Text="POI" Style="{StaticResource SectionHeaderStyle}"/>
                <Border BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="0,5,0,10">
                    <DataGrid ItemsSource="{Binding POIItems}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="True"
                              CanUserReorderColumns="False"
                              CanUserSortColumns="False"
                              HeadersVisibility="Column"
                              GridLinesVisibility="All"
                              MaxHeight="250"
                              VerticalScrollBarVisibility="Auto">

                        <DataGrid.Columns>
                            <!-- è¾“å…¥æ•°æ®åˆ— -->
                            <DataGridTemplateColumn Header="è¾“å…¥æ•°æ®" Width="2*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="30"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox Grid.Column="0"
                                                     Text="{Binding DataName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                     IsReadOnly="True"
                                                     VerticalContentAlignment="Center"
                                                     AllowDrop="True"
                                                     PreviewDragOver="POIItem_PreviewDragOver"
                                                     Drop="POIItem_Drop"/>

                                            <Button Grid.Column="1"
                                                    Content="ğŸ“"
                                                    FontSize="12"
                                                    Width="25"
                                                    Height="22"
                                                    Command="{Binding DataContext.BrowsePOICommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"/>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- è·ç¦»åˆ— -->
                            <DataGridTemplateColumn Header="è·ç¦»" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Distance, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 IsEnabled="{Binding IsDistanceEnabled}"
                                                 VerticalContentAlignment="Center"
                                                 HorizontalContentAlignment="Right"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- æƒé‡åˆ— -->
                            <DataGridTemplateColumn Header="æƒé‡" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Weight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"
                                                 VerticalContentAlignment="Center"
                                                 HorizontalContentAlignment="Right"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- è‡ªå®šä¹‰è·ç¦»é—´éš”åˆ— -->
                            <DataGridTemplateColumn Header="è‡ªå®šä¹‰è·ç¦»é—´éš”" Width="1.5*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ComboBox SelectedValue="{Binding CustomInterval, Mode=TwoWay}"
                                                  VerticalContentAlignment="Center">
                                            <ComboBoxItem Content="æ˜¯" Tag="True"/>
                                            <ComboBoxItem Content="å¦" Tag="False" IsSelected="True"/>
                                        </ComboBox>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- æƒé‡éªŒè¯æç¤º -->
                <TextBlock Text="{Binding WeightSumValidationMessage}"
                           Foreground="Red"
                           FontSize="12"
                           Margin="0,0,0,10"
                           Visibility="{Binding IsWeightSumValid, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                <!-- 4. è¾“å‡ºéƒ¨åˆ† -->
                <TextBlock Text="è¾“å‡º" Style="{StaticResource SectionHeaderStyle}"/>
                <Border BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="0,5,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="è¾“å‡ºè¦ç´ " VerticalAlignment="Center" Margin="5,0"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding OutputPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 VerticalContentAlignment="Center"
                                 Margin="5,0"/>
                        <Button Grid.Column="2"
                                Style="{StaticResource FolderButtonStyle}"
                                Command="{Binding BrowseOutputCommand}"/>
                    </Grid>
                </Border>

                <!-- 5. è¿è¡ŒæŒ‰é’® -->
                <Button Content="â–¶ è¿è¡Œ"
                        HorizontalAlignment="Right"
                        Width="100"
                        Height="35"
                        FontSize="14"
                        Margin="0,10,0,0"
                        Command="{Binding RunAnalysisCommand}"
                        Style="{DynamicResource Esri_Button}"/>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
```

---

## å››ã€ä¸»ç•Œé¢ViewModelè®¾è®¡ (main_dockpaneViewModel.cs)

```csharp
using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Windows.Input;
using ArcGIS.Desktop.Framework;
using ArcGIS.Desktop.Framework.Contracts;
using ArcGIS.Desktop.Framework.Dialogs;
using HK_AREA_SEARCH.Models;

namespace HK_AREA_SEARCH
{
    internal class main_dockpaneViewModel : DockPane
    {
        private const string _dockPaneID = "HK_AREA_SEARCH_main_dockpane";

        #region å±æ€§

        private string _heading = "é¦™æ¸¯é€‰å€å·¥å…·";
        public string Heading
        {
            get { return _heading; }
            set { SetProperty(ref _heading, value, () => Heading); }
        }

        /// <summary>
        /// çº¦æŸæ¡ä»¶æ•°æ®é›†åˆ
        /// </summary>
        private ObservableCollection<ConstraintDataItem> _constraintItems;
        public ObservableCollection<ConstraintDataItem> ConstraintItems
        {
            get { return _constraintItems; }
            set { SetProperty(ref _constraintItems, value, () => ConstraintItems); }
        }

        /// <summary>
        /// åˆ†æåŒºåŸŸè·¯å¾„
        /// </summary>
        private string _analysisAreaPath;
        public string AnalysisAreaPath
        {
            get { return _analysisAreaPath; }
            set { SetProperty(ref _analysisAreaPath, value, () => AnalysisAreaPath); }
        }

        /// <summary>
        /// POIæ•°æ®é›†åˆ
        /// </summary>
        private ObservableCollection<POIDataItem> _poiItems;
        public ObservableCollection<POIDataItem> POIItems
        {
            get { return _poiItems; }
            set { SetProperty(ref _poiItems, value, () => POIItems); }
        }

        /// <summary>
        /// è¾“å‡ºè·¯å¾„
        /// </summary>
        private string _outputPath;
        public string OutputPath
        {
            get { return _outputPath; }
            set { SetProperty(ref _outputPath, value, () => OutputPath); }
        }

        /// <summary>
        /// æƒé‡å’ŒéªŒè¯æ¶ˆæ¯
        /// </summary>
        private string _weightSumValidationMessage;
        public string WeightSumValidationMessage
        {
            get { return _weightSumValidationMessage; }
            set { SetProperty(ref _weightSumValidationMessage, value, () => WeightSumValidationMessage); }
        }

        /// <summary>
        /// æƒé‡å’Œæ˜¯å¦æœ‰æ•ˆ
        /// </summary>
        private bool _isWeightSumValid;
        public bool IsWeightSumValid
        {
            get { return _isWeightSumValid; }
            set { SetProperty(ref _isWeightSumValid, value, () => IsWeightSumValid); }
        }

        #endregion

        #region å‘½ä»¤

        /// <summary>
        /// æµè§ˆçº¦æŸæ¡ä»¶æ•°æ®å‘½ä»¤
        /// </summary>
        public ICommand BrowseConstraintCommand { get; private set; }

        /// <summary>
        /// æµè§ˆåˆ†æåŒºåŸŸå‘½ä»¤
        /// </summary>
        public ICommand BrowseAnalysisAreaCommand { get; private set; }

        /// <summary>
        /// æµè§ˆPOIæ•°æ®å‘½ä»¤
        /// </summary>
        public ICommand BrowsePOICommand { get; private set; }

        /// <summary>
        /// æµè§ˆè¾“å‡ºè·¯å¾„å‘½ä»¤
        /// </summary>
        public ICommand BrowseOutputCommand { get; private set; }

        /// <summary>
        /// è¿è¡Œåˆ†æå‘½ä»¤
        /// </summary>
        public ICommand RunAnalysisCommand { get; private set; }

        #endregion

        #region æ„é€ å‡½æ•°

        protected main_dockpaneViewModel()
        {
            InitializeCollections();
            InitializeCommands();
            SubscribeToPropertyChanges();
        }

        private void InitializeCollections()
        {
            // åˆå§‹åŒ–çº¦æŸæ¡ä»¶é›†åˆï¼ˆ5ä¸ªç©ºç™½è¡Œï¼‰
            ConstraintItems = new ObservableCollection<ConstraintDataItem>();
            for (int i = 0; i < 5; i++)
            {
                ConstraintItems.Add(new ConstraintDataItem());
            }

            // åˆå§‹åŒ–POIé›†åˆï¼ˆ2ä¸ªç©ºç™½è¡Œï¼‰
            POIItems = new ObservableCollection<POIDataItem>();
            POIItems.Add(new POIDataItem());
            POIItems.Add(new POIDataItem());
        }

        private void InitializeCommands()
        {
            BrowseConstraintCommand = new RelayCommand(BrowseConstraintData, () => true);
            BrowseAnalysisAreaCommand = new RelayCommand(BrowseAnalysisArea, () => true);
            BrowsePOICommand = new RelayCommand(BrowsePOIData, () => true);
            BrowseOutputCommand = new RelayCommand(BrowseOutputPath, () => true);
            RunAnalysisCommand = new RelayCommand(RunAnalysis, CanRunAnalysis);
        }

        private void SubscribeToPropertyChanges()
        {
            // ç›‘å¬çº¦æŸæ¡ä»¶å˜åŒ–
            ConstraintItems.CollectionChanged += (s, e) => AutoAddEmptyRow(ConstraintItems);

            // ç›‘å¬POIæ•°æ®å˜åŒ–
            POIItems.CollectionChanged += (s, e) =>
            {
                AutoAddEmptyRow(POIItems);
                ValidateWeightSum();
            };
        }

        #endregion

        #region æ–¹æ³•

        /// <summary>
        /// è‡ªåŠ¨æ·»åŠ ç©ºç™½è¡Œ
        /// </summary>
        private void AutoAddEmptyRow<T>(ObservableCollection<T> collection) where T : new()
        {
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è¡Œéƒ½å·²å¡«å……
            bool allFilled = true;
            foreach (var item in collection)
            {
                if (item is ConstraintDataItem constraint && constraint.IsEmpty)
                {
                    allFilled = false;
                    break;
                }
                else if (item is POIDataItem poi && poi.IsEmpty)
                {
                    allFilled = false;
                    break;
                }
            }

            // å¦‚æœæ‰€æœ‰è¡Œéƒ½å·²å¡«å……ï¼Œæ·»åŠ æ–°ç©ºç™½è¡Œ
            if (allFilled)
            {
                collection.Add(new T());
            }
        }

        /// <summary>
        /// éªŒè¯æƒé‡å’Œ
        /// </summary>
        private void ValidateWeightSum()
        {
            var nonEmptyItems = POIItems.Where(p => !p.IsEmpty && p.Weight.HasValue).ToList();

            if (nonEmptyItems.Count == 0)
            {
                IsWeightSumValid = false;
                WeightSumValidationMessage = "";
                return;
            }

            double sum = nonEmptyItems.Sum(p => p.Weight.Value);

            if (Math.Abs(sum - 1.0) > 0.001) // å…è®¸0.001çš„è¯¯å·®
            {
                IsWeightSumValid = true; // æ˜¾ç¤ºæ¶ˆæ¯
                WeightSumValidationMessage = $"è­¦å‘Š: æƒé‡ä¹‹å’Œä¸º {sum:F2}ï¼Œåº”ä¸º 1.0";
            }
            else
            {
                IsWeightSumValid = false; // éšè—æ¶ˆæ¯
                WeightSumValidationMessage = "";
            }
        }

        /// <summary>
        /// æµè§ˆçº¦æŸæ¡ä»¶æ•°æ®
        /// </summary>
        private void BrowseConstraintData(object parameter)
        {
            var item = parameter as ConstraintDataItem;
            if (item == null) return;

            // æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
            var dialog = new Microsoft.Win32.OpenFileDialog
            {
                Filter = "Shapefile (*.shp)|*.shp|GeoDatabase Feature Class|*.gdb|All Files (*.*)|*.*",
                Title = "é€‰æ‹©çº¦æŸæ¡ä»¶æ•°æ®"
            };

            if (dialog.ShowDialog() == true)
            {
                item.DataPath = dialog.FileName;
            }
        }

        /// <summary>
        /// æµè§ˆåˆ†æåŒºåŸŸ
        /// </summary>
        private void BrowseAnalysisArea()
        {
            var dialog = new Microsoft.Win32.OpenFileDialog
            {
                Filter = "Shapefile (*.shp)|*.shp|GeoDatabase Feature Class|*.gdb|All Files (*.*)|*.*",
                Title = "é€‰æ‹©åˆ†æåŒºåŸŸ"
            };

            if (dialog.ShowDialog() == true)
            {
                AnalysisAreaPath = dialog.FileName;
            }
        }

        /// <summary>
        /// æµè§ˆPOIæ•°æ®
        /// </summary>
        private void BrowsePOIData(object parameter)
        {
            var item = parameter as POIDataItem;
            if (item == null) return;

            var dialog = new Microsoft.Win32.OpenFileDialog
            {
                Filter = "æ‰€æœ‰æ”¯æŒæ ¼å¼|*.shp;*.tif;*.tiff;*.img|Shapefile (*.shp)|*.shp|Raster (*.tif;*.tiff;*.img)|*.tif;*.tiff;*.img|All Files (*.*)|*.*",
                Title = "é€‰æ‹©POIæ•°æ®æˆ–æ …æ ¼"
            };

            if (dialog.ShowDialog() == true)
            {
                item.DataPath = dialog.FileName;
            }
        }

        /// <summary>
        /// æµè§ˆè¾“å‡ºè·¯å¾„
        /// </summary>
        private void BrowseOutputPath()
        {
            var dialog = new Microsoft.Win32.SaveFileDialog
            {
                Filter = "Shapefile (*.shp)|*.shp",
                Title = "é€‰æ‹©è¾“å‡ºè·¯å¾„",
                FileName = "Result_Rating_Suitable_Area.shp"
            };

            if (dialog.ShowDialog() == true)
            {
                OutputPath = dialog.FileName;
            }
        }

        /// <summary>
        /// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿è¡Œåˆ†æ
        /// </summary>
        private bool CanRunAnalysis()
        {
            // è‡³å°‘éœ€è¦åˆ†æåŒºåŸŸã€ä¸€ä¸ªPOIæ•°æ®ã€è¾“å‡ºè·¯å¾„
            return !string.IsNullOrWhiteSpace(AnalysisAreaPath) &&
                   POIItems.Any(p => !p.IsEmpty) &&
                   !string.IsNullOrWhiteSpace(OutputPath);
        }

        /// <summary>
        /// è¿è¡Œåˆ†æ
        /// </summary>
        private void RunAnalysis()
        {
            // éªŒè¯æƒé‡å’Œ
            var nonEmptyPOI = POIItems.Where(p => !p.IsEmpty).ToList();
            double weightSum = nonEmptyPOI.Sum(p => p.Weight ?? 0);

            if (Math.Abs(weightSum - 1.0) > 0.001)
            {
                MessageBox.Show($"æƒé‡ä¹‹å’Œå¿…é¡»ä¸º1.0ï¼Œå½“å‰ä¸º{weightSum:F2}", "éªŒè¯å¤±è´¥");
                return;
            }

            // è¿™é‡Œè°ƒç”¨åç»­çš„åˆ†æåŠŸèƒ½æ¨¡å—
            // TODO: è°ƒç”¨Divideã€Distanceã€Ratingæ¨¡å—

            MessageBox.Show("å¼€å§‹è¿è¡Œé€‰å€åˆ†æ...", "æç¤º");
        }

        #endregion

        #region DockPaneæ–¹æ³•

        internal static void Show()
        {
            DockPane pane = FrameworkApplication.DockPaneManager.Find(_dockPaneID);
            if (pane == null)
                return;

            pane.Activate();
        }

        #endregion
    }

    /// <summary>
    /// æŒ‰é’®å®ç°ä»¥æ˜¾ç¤ºDockPane
    /// </summary>
    internal class main_dockpane_ShowButton : Button
    {
        protected override void OnClick()
        {
            main_dockpaneViewModel.Show();
        }
    }
}
```

---

## äº”ã€è‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†è®¾è®¡

### 5.1 XAML (CustomIntervalDialog.xaml)

```xaml
<Window x:Class="HK_AREA_SEARCH.Views.CustomIntervalDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:extensions="clr-namespace:ArcGIS.Desktop.Extensions;assembly=ArcGIS.Desktop.Extensions"
        Title="è‡ªå®šä¹‰è·ç¦»é—´éš”"
        Height="450"
        Width="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <extensions:DesignOnlyResourceDictionary Source="pack://application:,,,/ArcGIS.Desktop.Framework;component\Themes\Default.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ•°æ®åç§°æ ‡é¢˜ -->
        <TextBlock Grid.Row="0"
                   Text="{Binding DataName, StringFormat='æ•°æ®: {0}'}"
                   FontSize="14"
                   FontWeight="Bold"
                   Margin="0,0,0,10"/>

        <!-- åˆ†ç±»è¡¨æ ¼ -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding IntervalClasses}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="False"
                  CanUserSortColumns="False"
                  HeadersVisibility="Column"
                  GridLinesVisibility="All">

            <DataGrid.Columns>
                <DataGridTextColumn Header="å¼€å§‹"
                                    Binding="{Binding StartValue, StringFormat=F2}"
                                    Width="*"/>
                <DataGridTextColumn Header="ç»“æŸ"
                                    Binding="{Binding EndValue, StringFormat=F2}"
                                    Width="*"/>
                <DataGridTextColumn Header="ç±»åˆ«"
                                    Binding="{Binding ClassValue}"
                                    Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ç¡®å®šæŒ‰é’® -->
        <Button Grid.Row="2"
                Content="ç¡®å®š"
                Width="100"
                Height="30"
                HorizontalAlignment="Right"
                Margin="0,10,0,0"
                Click="OkButton_Click"
                Style="{DynamicResource Esri_Button}"/>
    </Grid>
</Window>
```

### 5.2 ViewModel (CustomIntervalDialogViewModel.cs)

```csharp
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using HK_AREA_SEARCH.Models;

namespace HK_AREA_SEARCH.ViewModels
{
    /// <summary>
    /// è‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†ViewModel
    /// </summary>
    public class CustomIntervalDialogViewModel : INotifyPropertyChanged
    {
        private string _dataName;
        private ObservableCollection<IntervalClassItem> _intervalClasses;

        /// <summary>
        /// æ•°æ®åç§°
        /// </summary>
        public string DataName
        {
            get => _dataName;
            set
            {
                if (_dataName != value)
                {
                    _dataName = value;
                    OnPropertyChanged();
                }
            }
        }

        /// <summary>
        /// åˆ†ç±»é—´éš”é›†åˆ
        /// </summary>
        public ObservableCollection<IntervalClassItem> IntervalClasses
        {
            get => _intervalClasses;
            set
            {
                if (_intervalClasses != value)
                {
                    _intervalClasses = value;
                    OnPropertyChanged();
                }
            }
        }

        public CustomIntervalDialogViewModel(string dataName, bool isPositiveDistance)
        {
            DataName = dataName;
            InitializeDefaultIntervals(isPositiveDistance);
        }

        /// <summary>
        /// åˆå§‹åŒ–é»˜è®¤çš„ç›¸ç­‰é—´éš”åˆ†ç±»
        /// </summary>
        private void InitializeDefaultIntervals(bool isPositiveDistance)
        {
            IntervalClasses = new ObservableCollection<IntervalClassItem>();

            // è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…æ•°æ®èŒƒå›´è®¡ç®—ç›¸ç­‰é—´éš”
            // ç¤ºä¾‹ï¼šå‡è®¾èŒƒå›´æ˜¯0-1000ç±³
            double minValue = 0;
            double maxValue = 1000;
            double interval = (maxValue - minValue) / 10;

            for (int i = 0; i < 10; i++)
            {
                int classValue = isPositiveDistance ? (10 - i) : (i + 1);

                IntervalClasses.Add(new IntervalClassItem
                {
                    StartValue = minValue + i * interval,
                    EndValue = minValue + (i + 1) * interval,
                    ClassValue = classValue
                });
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}
```

---

## å…­ã€è½¬æ¢å™¨è®¾è®¡

### 6.1 å¸ƒå°”å€¼è½¬"æ˜¯/å¦"è½¬æ¢å™¨

```csharp
using System;
using System.Globalization;
using System.Windows.Data;

namespace HK_AREA_SEARCH.Converters
{
    /// <summary>
    /// å¸ƒå°”å€¼è½¬"æ˜¯/å¦"è½¬æ¢å™¨
    /// </summary>
    public class BooleanToYesNoConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is bool boolValue)
            {
                return boolValue ? "æ˜¯" : "å¦";
            }
            return "å¦";
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is string strValue)
            {
                return strValue == "æ˜¯";
            }
            return false;
        }
    }
}
```

---

## ä¸ƒã€æ‹–æ”¾è¾…åŠ©ç±»è®¾è®¡

### 7.1 DragDropHelper.cs

```csharp
using System.Windows;
using ArcGIS.Desktop.Mapping;

namespace HK_AREA_SEARCH.Helpers
{
    /// <summary>
    /// æ‹–æ”¾è¾…åŠ©ç±»
    /// </summary>
    public static class DragDropHelper
    {
        /// <summary>
        /// ä»æ‹–æ”¾æ•°æ®ä¸­æå–å›¾å±‚è·¯å¾„
        /// </summary>
        public static string GetLayerPathFromDragDrop(DragEventArgs e)
        {
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ–‡ä»¶æ‹–æ”¾
            if (e.Data.GetDataPresent(DataFormats.FileDrop))
            {
                string[] files = (string[])e.Data.GetData(DataFormats.FileDrop);
                if (files != null && files.Length > 0)
                {
                    return files[0];
                }
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾å±‚æ‹–æ”¾ï¼ˆä»ArcGIS Proçš„TOCï¼‰
            if (e.Data.GetDataPresent("esri_map_layers"))
            {
                var layers = e.Data.GetData("esri_map_layers") as Layer[];
                if (layers != null && layers.Length > 0)
                {
                    var layer = layers[0];
                    // è·å–å›¾å±‚æ•°æ®æºè·¯å¾„
                    if (layer is FeatureLayer featureLayer)
                    {
                        return featureLayer.GetFeatureClass().GetDatastore().GetPath();
                    }
                    else if (layer is RasterLayer rasterLayer)
                    {
                        return rasterLayer.GetRaster().GetDatastore().GetPath();
                    }
                }
            }

            return null;
        }

        /// <summary>
        /// éªŒè¯æ‹–æ”¾çš„æ•°æ®æ ¼å¼
        /// </summary>
        public static bool IsValidDragDropData(DragEventArgs e)
        {
            return e.Data.GetDataPresent(DataFormats.FileDrop) ||
                   e.Data.GetDataPresent("esri_map_layers");
        }
    }
}
```

---

## å…«ã€ä»£ç éšè—æ–‡ä»¶ (main_dockpane.xaml.cs)

```csharp
using System.Windows;
using System.Windows.Controls;
using HK_AREA_SEARCH.Models;
using HK_AREA_SEARCH.Helpers;

namespace HK_AREA_SEARCH
{
    /// <summary>
    /// main_dockpaneView.xaml çš„äº¤äº’é€»è¾‘
    /// </summary>
    public partial class main_dockpaneView : UserControl
    {
        public main_dockpaneView()
        {
            InitializeComponent();
        }

        #region çº¦æŸæ¡ä»¶æ‹–æ”¾äº‹ä»¶

        private void ConstraintItem_PreviewDragOver(object sender, DragEventArgs e)
        {
            if (DragDropHelper.IsValidDragDropData(e))
            {
                e.Effects = DragDropEffects.Copy;
                e.Handled = true;
            }
            else
            {
                e.Effects = DragDropEffects.None;
            }
        }

        private void ConstraintItem_Drop(object sender, DragEventArgs e)
        {
            var textBox = sender as TextBox;
            var item = textBox?.DataContext as ConstraintDataItem;

            if (item != null)
            {
                string path = DragDropHelper.GetLayerPathFromDragDrop(e);
                if (!string.IsNullOrEmpty(path))
                {
                    item.DataPath = path;
                }
            }

            e.Handled = true;
        }

        #endregion

        #region åˆ†æåŒºåŸŸæ‹–æ”¾äº‹ä»¶

        private void AnalysisArea_PreviewDragOver(object sender, DragEventArgs e)
        {
            if (DragDropHelper.IsValidDragDropData(e))
            {
                e.Effects = DragDropEffects.Copy;
                e.Handled = true;
            }
            else
            {
                e.Effects = DragDropEffects.None;
            }
        }

        private void AnalysisArea_Drop(object sender, DragEventArgs e)
        {
            var viewModel = DataContext as main_dockpaneViewModel;
            if (viewModel != null)
            {
                string path = DragDropHelper.GetLayerPathFromDragDrop(e);
                if (!string.IsNullOrEmpty(path))
                {
                    viewModel.AnalysisAreaPath = path;
                }
            }

            e.Handled = true;
        }

        #endregion

        #region POIæ‹–æ”¾äº‹ä»¶

        private void POIItem_PreviewDragOver(object sender, DragEventArgs e)
        {
            if (DragDropHelper.IsValidDragDropData(e))
            {
                e.Effects = DragDropEffects.Copy;
                e.Handled = true;
            }
            else
            {
                e.Effects = DragDropEffects.None;
            }
        }

        private void POIItem_Drop(object sender, DragEventArgs e)
        {
            var textBox = sender as TextBox;
            var item = textBox?.DataContext as POIDataItem;

            if (item != null)
            {
                string path = DragDropHelper.GetLayerPathFromDragDrop(e);
                if (!string.IsNullOrEmpty(path))
                {
                    item.DataPath = path;
                }
            }

            e.Handled = true;
        }

        #endregion
    }
}
```

---

## ä¹ã€è‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†ä»£ç éšè—

```csharp
using System.Windows;
using HK_AREA_SEARCH.ViewModels;

namespace HK_AREA_SEARCH.Views
{
    /// <summary>
    /// CustomIntervalDialog.xaml çš„äº¤äº’é€»è¾‘
    /// </summary>
    public partial class CustomIntervalDialog : Window
    {
        public CustomIntervalDialogViewModel ViewModel { get; private set; }

        public CustomIntervalDialog(string dataName, bool isPositiveDistance)
        {
            InitializeComponent();

            ViewModel = new CustomIntervalDialogViewModel(dataName, isPositiveDistance);
            DataContext = ViewModel;
        }

        private void OkButton_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = true;
            Close();
        }
    }
}
```

---

## åã€å…³é”®å®ç°è¯´æ˜

### 10.1 çº¦æŸæ¡ä»¶åŠ¨æ€è¡Œç®¡ç†
- ä½¿ç”¨ `ObservableCollection` è‡ªåŠ¨ç®¡ç†é›†åˆå˜åŒ–
- å½“æ‰€æœ‰è¡Œå¡«å……åè‡ªåŠ¨æ·»åŠ æ–°ç©ºç™½è¡Œ
- ç©ºç™½è¡Œä¸å‚ä¸åˆ†æè®¡ç®—

### 10.2 POIè¡¨æ ¼éªŒè¯
- **è·ç¦»å­—æ®µ**: æ …æ ¼æ•°æ®æ—¶è‡ªåŠ¨ç¦ç”¨å¹¶ç½®ç©º
- **æƒé‡éªŒè¯**: å®æ—¶è®¡ç®—æ€»å’Œå¹¶ä»¥çº¢è‰²æç¤º
- **è‡ªå®šä¹‰é—´éš”**: ä¸‹æ‹‰æ¡†é€‰æ‹©åè§¦å‘å¯¹è¯æ¡†

### 10.3 æ‹–æ”¾åŠŸèƒ½
- æ”¯æŒä»Windowsèµ„æºç®¡ç†å™¨æ‹–æ”¾æ–‡ä»¶
- æ”¯æŒä»ArcGIS Proå›¾å±‚ç›®å½•ï¼ˆTOCï¼‰æ‹–æ”¾å›¾å±‚
- è‡ªåŠ¨æå–å›¾å±‚æ•°æ®æºè·¯å¾„

### 10.4 æ•°æ®ç»‘å®š
- åŒå‘ç»‘å®šç¡®ä¿UIä¸æ•°æ®åŒæ­¥
- `UpdateSourceTrigger=PropertyChanged` å®ç°å®æ—¶æ›´æ–°
- `INotifyPropertyChanged` æ¥å£é€šçŸ¥å±æ€§å˜åŒ–

### 10.5 è‡ªå®šä¹‰è·ç¦»é—´éš”å¯¹è¯æ¡†
- å¼¹å‡ºçª—å£æ˜¾ç¤ºé»˜è®¤ç›¸ç­‰é—´éš”åˆ†ç±»
- ç”¨æˆ·å¯ç¼–è¾‘æ¯ä¸ªç±»åˆ«çš„å¼€å§‹å€¼ã€ç»“æŸå€¼
- ç¡®å®šåå°†æ•°æ®è¿”å›ç»™ä¸»ç•Œé¢

---

## åä¸€ã€åç»­é›†æˆå»ºè®®

1. **ä¸åŠŸèƒ½æ¨¡å—é›†æˆ**
   - åœ¨ `RunAnalysis()` æ–¹æ³•ä¸­è°ƒç”¨ Divideã€Distanceã€Rating æ¨¡å—
   - ä¼ é€’ç•Œé¢æ”¶é›†çš„å‚æ•°åˆ°å„åŠŸèƒ½æ¨¡å—

2. **è¿›åº¦åé¦ˆ**
   - æ·»åŠ è¿›åº¦æ¡æ˜¾ç¤ºåˆ†æè¿›åº¦
   - ä½¿ç”¨å¼‚æ­¥æ“ä½œé¿å…ç•Œé¢å†»ç»“

3. **é”™è¯¯å¤„ç†**
   - æ·»åŠ æ–‡ä»¶è·¯å¾„éªŒè¯
   - æ·»åŠ æ•°æ®æ ¼å¼éªŒè¯
   - æä¾›å‹å¥½çš„é”™è¯¯æç¤º

4. **ç»“æœå¯è§†åŒ–**
   - åˆ†æå®Œæˆåè‡ªåŠ¨æ·»åŠ ç»“æœå›¾å±‚åˆ°åœ°å›¾
   - è®¾ç½®å¤šçº§è‰²å½©ç¬¦å·ç³»ç»Ÿ
   - ä»¥è¯„åˆ†å­—æ®µä¸ºåˆ†ç±»æ ‡å‡†

---

## åäºŒã€ç•Œé¢æ•ˆæœå¯¹æ¯”

æœ¬è®¾è®¡æ–¹æ¡ˆå®Œå…¨ç¬¦åˆ `å›¾2ç•Œé¢è®¾è®¡.png` çš„å¸ƒå±€è¦æ±‚ï¼š

- âœ… çº¦æŸæ¡ä»¶ï¼šæ”¯æŒæ‰¹é‡è¾“å…¥ã€æ˜¾ç¤ºæ•°æ®åç§°ã€æ–‡ä»¶å›¾æ ‡ã€æ‹–æ”¾åŠŸèƒ½
- âœ… åœ°åŒºï¼šå•ä¸ªè¾“å…¥æ¡†ã€æ–‡ä»¶å›¾æ ‡
- âœ… POIè¡¨æ ¼ï¼š4åˆ—ï¼ˆè¾“å…¥æ•°æ®ã€è·ç¦»ã€æƒé‡ã€è‡ªå®šä¹‰è·ç¦»é—´éš”ï¼‰
- âœ… è¾“å‡ºï¼šå•ä¸ªè·¯å¾„é€‰æ‹©
- âœ… è¿è¡ŒæŒ‰é’®ï¼šå³ä¸‹è§’å®šä½

---

**æ–¹æ¡ˆå®Œæˆæ—¥æœŸ**: 2025-10-04
